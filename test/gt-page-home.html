<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>kart-home</title>

  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>

  <!-- Import the element to test -->
  <link rel="import" href="../src/pages/gt-page-home.html">

</head>
<body>

  <test-fixture id="page">
    <template>
       <gt-page-home></gt-page-home>
    </template>
  </test-fixture>

  <script>
    /* * * * * * * * * */
    suite('gt-page-home tests', function() {
      var page;                 // a reference to the page
      this.timeout(1000);       // how long to wait before timing out a test

      setup(function() {
        page = fixture('page');
      });

      /* * * * * * * * * */
      suite('server', function() {

        var ironAjax;             // a reference to the iron-ajax element in the page
        var server;
        var responseHeaders = {
          json: { 'Content-Type': 'application/json' }
        };

        setup(function() {
          server = sinon.fakeServer.create();

          ironAjax = Polymer.dom(page.root).querySelector('iron-ajax');

          ironAjax.addEventListener('request', function() {
            server.respond();
          });
        });

        teardown(function() {
          server.restore();
        });

        /* * * * * * * * * */
        suite('positive responses', function() {

          setup(function() {
            server.respondWith(
              'GET',
              /home.json/,
              [ 200, responseHeaders.json, '{}' ] // the content that is received is not important for these test. It should be tested server side.
            );
          });

          test('Page fires "page-loaded" event when ready', function(done) {
            page.addEventListener('page-loaded',  function(e) {
              done();
            });
          });
        });

        /* * * * * * * * * */
        suite('negitive responses', function() {

          setup(function() {
            server.respondWith(
              'GET',
              /home.json/,
              [ 404, {}, '' ]
            );
          });

          test('Page fires "page-error" event if ajax fails', function(done) {
            page.addEventListener('page-error',  function(e) {
              done();
            });
          });
        });
      });
    });
  </script>

</body>
</html>
