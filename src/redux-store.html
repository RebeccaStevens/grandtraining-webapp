<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">
<link rel="import" href="../imports/gt.html">
<script src="../node_modules/redux/dist/redux.js"></script>

<script>
  /**
   * The initial state of the app.
   */
  var initialState = {
    dataPath: 'http://grandtraining.local/data/', // The path where this app should download data from. This path should alwasy end with a slash ('/').
    formHandlerPath: 'http://grandtraining.local/', // The path to form handlers. This path should alwasy end with a slash ('/').

    config: undefined,
    venue: undefined,

    shellLoading: true,
    pageLoading: true,
    shellError: false,
    pageError: false,

    signedInUser: null
  };

  /**
   * Update the state of the application based on the current state and the action just performed.
   */
  var reducer = function(state, action) {
    if (!state) {
      return initialState;
    }

    switch (action.type) {
      case 'INIT':
        return Object.assign({}, state, {
          config: Object.assign({}, action.config)
        });

      case 'SET_VENUE':
        return Object.assign({}, state, {
          venue: Object.assign({}, action.venue)
        });

      case 'SET_PAGE_LOADING':
        return Object.assign({}, state, {
          pageLoading: action.loading
        });

      case 'SET_PAGE_ERROR':
        return Object.assign({}, state, {
          pageError: action.error
        });

      case 'SET_SHELL_LOADING':
        return Object.assign({}, state, {
          shellLoading: action.loading
        });

      case 'SET_SHELL_ERROR':
        return Object.assign({}, state, {
          shellError: action.error
        });

      case 'SIGN_IN':
        return Object.assign({}, state, {
          signedInUser: Object.assign({}, action.user)
        });

      case 'SIGN_OUT':
        return Object.assign({}, state, {
          signedInUser: null
        });
    }
  };

  // create the redux store
  var store = Redux.createStore(reducer);

  // create the Behavior for use in elements
  GT.ReduxBehavior = PolymerRedux(store);
</script>
