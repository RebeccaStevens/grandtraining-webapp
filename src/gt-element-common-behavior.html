<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../imports/gt.html">
<link rel="import" href="redux-store.html">

<script>

  var ElementCommonBehaviorImpl = {

    actions: {
      setIDToken: function(idToken) {
        return {
          type: 'SET_ID_TOKEN',
          idToken: idToken
        };
      },

      setVenue: function(venue) {
        return {
          type: 'SET_VENUE',
          venue: venue
        };
      },

      setPageLoading: function(loading) {
        return {
          type: 'SET_PAGE_LOADING',
          loading: loading
        };
      },

      setPageError: function(error) {
        return {
          type: 'SET_PAGE_ERROR',
          error: error
        };
      },

      signIn: function(newIdToken, rememberMe, firstName, lastName, email, phone, venue) {
        // if not set, use the current
        if (!(rememberMe === true || rememberMe === false)) {
          rememberMe = GT.ReduxBehavior.getState().rememberMe;
        }

        var fullName = null;
        if (firstName && lastName) {
          fullName = firstName + ' ' + lastName;
        }
        else if (firstName) {
          fullName = firstName;
        }
        else if (lastName) {
          fullName = lastName;
        }

        var user = {
          firstName: firstName,
          lastName: lastName,
          fullName: fullName,
          email: email,
          phone: phone,
          venue: venue
        };

        return {
          type: 'SIGN_IN',
          newIdToken: newIdToken,
          rememberMe: rememberMe,
          user: user
        };
      },

      signOut: function() {
        return {
          type: 'SIGN_OUT'
        };
      },

      setSigninBackUrl: function(url) {
        return {
          type: 'SET_SIGNIN_BACK_URL',
          url: url
        }
      },

      clearSigninBackUrl: function() {
        return {
          type: 'CLEAR_SIGNIN_BACK_URL'
        }
      }
    },

    properties: {

      /**
       * The app config data.
       */
      appConfig: {
        type: Object,
        statePath: 'config'
      },

      idToken: {
        type: String,
        statePath: 'idToken'
      },

      /**
       * The signed in user
       */
      user: {
        type: Object,
        statePath: 'signedInUser'
      },

      /**
       * True if the user is signed in.
       */
      signedIn: {
        type: Boolean,
        computed: '_computeSignedIn(user)'
      },

      cmsPreview: {
        type: Object,
        statePath: 'cmsPreview'
      },

      genders: {
        type: Array,
        value: ['Male', 'Female', 'Gender Diverse']
      }
    },

    /**
     * Get a url path to the api for the relative path given.
     *
     * @param {!String} path
     * @returns {String}
     */
    getApiUrl: function(path) {
      return GT.ReduxBehavior.getState().apiPath + path;
    },

    /**
     * Returns true if the array has any values.
     *
     * @param {Array} arr
     * @returns {Boolean}
     */
    doesArrayHaveValues: function(arr) {
      return arr && arr.length > 0;
    },

    /**
     * Returns true if the value is not undefined or null.
     *
     * @param {*} val
     * @returns {Boolean}
     */
    isDefined: function(val) {
      return val !== undefined && val !== null;
    },

    /**
     * Create a deep clone of the given object.
     *
     * @param {Object} obj - The object to clone
     * @returns {Object} - A deep clone of the object
     */
    cloneObject: function(obj) {
      return JSON.parse(JSON.stringify(obj));
    },

    /**
     * Compute the value of `user`
     */
    _computeSignedIn: function(user) {
      return !!user;
    }
  };

  GT.ElementCommonBehavior = [GT.ReduxBehavior, ElementCommonBehaviorImpl]
</script>
