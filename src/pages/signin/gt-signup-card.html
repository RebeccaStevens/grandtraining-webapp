<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../../styles/gt-styles.html">
<link rel="import" href="../../../imports/gt.html">
<link rel="import" href="../../gt-element-common-behavior.html">

<dom-module id="gt-signup-card">
  <template>
    <style include="gt-styles">
      :host {
        display: block;
      }
      a {
        cursor: pointer;
      }
      paper-button {
        margin: 0;
      }
      #card {
        width: 100%;
      }
      #card .card-content {
        padding: 0 16px 16px 16px;
      }
      #card .card-actions {
        @apply(--layout-horizontal);
        @apply(--layout-justified);
      }
      #notice {
        text-align: center;
        padding-left: 8px;
      }
    </style>

    <!-- Layout -->
    <paper-card id="card"heading="Sign Up">
      <div class="card-content">
        <paper-input id="email" class="field" name="email" type="email" label="Email Address" auto-validate required></paper-input>
        <paper-input id="password" class="field" name="password" type="password" label="Password" auto-validate required></paper-input>
        <paper-input id="password2" class="field" type="password" label="Password Confirm" auto-validate required></paper-input>
      </div>
      <div class="card-actions">
        <div id="notice">Already have an account?<br><a on-tap="_showSignInCard">[[appConfig.pages.signin.title]]</a> now.</div>
        <paper-button raised on-tap="_signup">Sign Up</paper-button>
      </div>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'gt-signup-card',

      behaviors: [
        GT.ElementCommonBehavior
      ],

      properties: {

        /**
         * The page this card is on.
         */
        page: Object
      },

      /**
       * Called when the signup button is clicked.
       */
      _signup: function() {
        this.$['email'].validate();
        this.$['password'].validate();

        // make sure the passwords match
        if (this.$['password'].value !== this.$['password2'].value) {
          this.$['password'].invalid = true;
          this.$['password2'].invalid = true;
        }

        if (!(this.$['email'].invalid ||
        this.$['password'].invalid)) {
          console.log('todo: signup');

          // redirect to account page after successful sign up
          window.history.pushState({}, null, GT.app.appConfig.pages.account.url);
          window.dispatchEvent(new CustomEvent('location-changed'));
        }
      },

      /**
       * Show the sign in card.
       */
      _showSignInCard: function() {
        this.page.showSignInCard();
      },

      focus: function() {
        this.$.email.focus();
      },

      ready: function() {
        Polymer.dom(this.root).querySelectorAll('.field').forEach(function(e) {
          e.onblur = GT.onFieldBlur;
        });
      }
    });
  </script>
</dom-module>
