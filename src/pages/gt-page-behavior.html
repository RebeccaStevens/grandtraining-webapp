<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../imports/gt.html">

<script>

  GT.PageBehavior = {
    properties: {

      /**
       * The name of the page.
       */
      name: {
        type: String,
        reflectToAttribute: true
      },

      /**
       * State's whether or not this page has been succesfully initialised.
       */
      isInitialised: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      },

      /**
       * The title of this page.
       */
      pageTitle: {
        type: String,
        value: ''
      },

      /**
       * If true, the user must be logged in to view this page.
       */
      requiresLogin: {
        type: Boolean,
        value: false
      }
    },

    /**
     * This method must be called once the page has finished loading.
     *
     * If the page does not need any extra data (i.e. it doesn't need to make any ajax requests)
     * This method should be called from the page's ready funcion. Otherwise this method should
     * be called once the ajax request has finished.
     */
    pageReady: function() {
      this._setIsInitialised(true);
      this.fire('page-loaded');
    },

    /**
     * This method should be called if an error occurs while initialising the page.
     */
    pageError: function() {
      this._setIsInitialised(false);
      this.fire('page-error');
    },

    /**
     * This method should be called if the page needs to be reinitialising.
     */
    pageNeedsReinitialising: function() {
      this._setIsInitialised(false);
      this.fire('page-needs-reinitialising');
    },

    /**
     * Check if the current user can view this page.
     *
     * @param {Boolean} [signinPrompt=true] - If true, the user will be prompted to signin if they are not
     * @returns {Boolean}
     */
    canView: function(signinPrompt) {
      if (signinPrompt === undefined) {
        signinPrompt = true;
      }

      if (this.requiresLogin && this.user === null) {
        if (signinPrompt) {
          GT.app.signinPrompt(window.location.href);
        }
        return false;
      }
      return true;
    },

    /**
     * Called when the page is switched back to.
     */
    onSwitchBackTo: function() {
      if (this.canView()) {
        this.displayPageTitle();
      }
    },

    /**
     * Called when the page is switched from.
     */
    onSwitchFrom: function() {
    },

    /**
     * Set the title of this page.
     *
     * @param {!String} [title=pageTitle] - the title to set
     * @param {!Boolean} [withSiteName=true] - include tje name of the site in the title
     */
    displayPageTitle: function(title, withSiteName) {
      if (!title) {
        title = this.pageTitle;
      }
      if (title === '' || title === undefined || title === null) {
        document.title = this.appConfig.company.name;
      } else if (withSiteName !== false) {
        document.title = title + ' - ' + this.appConfig.company.name;
      } else {
        document.title = title;
      }
    }
  };
</script>
