<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../imports/gt.html">

<script>

  GT.PageContainerBehavior = {
    properties: {

      /**
       * The name of the page we are on.
       */
      pageName: {
        type: String,
        reflectToAttribute: true,
        observer: 'pageChanged'
      },

      /**
       * The pages element that contains the pages.
       */
      pages: {
        type: HTMLElement,
        value: function() {
          return this.$.pages
        }
      },

      /**
       * The name of the main page - the page to be displayed by default.
       */
      mainPageName: {
        type: String,
        value: 'home'
      },

      /**
       * The page that is currently being displayed.
       */
      renderedPageName: {
        type: String,
      },

      /**
       * The classes route.
       */
      route: Object,

      /**
       * The data contained in the route.
       */
      routeData: Object,

      /**
       * The subroute the app is on.
       */
      subroute: Object
    },

    observers: [
      '_routePageChanged(routeData.page)'
    ],

    /**
     * Called when the route data's page is changed.
     */
    _routePageChanged: function(pageName) {
      document.activeElement.blur();
      this.pageName = pageName || this.mainPageName;
    },

    /**
     * Returns the renderedPageName's element.
     *
     * @param {Boolean} deep
     * @returns {HTMLElement}
     */
    getRenderedPageElement: function(deep) {
      if (deep === undefined) {
        deep = false;
      }
      return this._getPageElementImpl(this.renderedPageName, deep);
    },

    /**
     * Returns the pageName's element.
     *
     * @param {Boolean} deep
     * @returns {HTMLElement}
     */
    getPageElement: function(deep) {
      if (deep === undefined) {
        deep = false;
      }
      return this._getPageElementImpl(this.pageName, deep);
    },

    /**
     * Implemtation of getPageElement and getRenderedPageElement.
     *
     * @param {String} name
     * @param {Boolean} deep
     * @returns {HTMLElement}
     */
    _getPageElementImpl: function(name, deep) {
      var pe = Polymer.dom(this.pages).querySelector('[name="' + name + '"]');

      if (deep) {
        while (pe && pe.pages && pe.renderedPageName && pe.getRenderedPageElement instanceof Function) {
          var deepPe = Polymer.dom(pe.pages).querySelector('[name="' + name + '"]');
          if (deepPe !== null) {
            pe = deepPe;
          } else {
            break;
          }
        }
      }
      return pe;
    }
  };
</script>
